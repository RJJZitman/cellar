
<!DOCTYPE html>

<html class="no-js" lang="en">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width,initial-scale=1" name="viewport"/>
<link href="../database/" rel="prev"/>
<link href="../testing/" rel="next"/>
<link href="../assets/images/favicon.png" rel="icon"/>
<meta content="mkdocs-1.5.3, mkdocs-material-9.5.14" name="generator"/>
<title>API - VinoDB</title>
<link href="../assets/stylesheets/main.10ba22f1.min.css" rel="stylesheet"/>
<link href="../assets/stylesheets/palette.06af60db.min.css" rel="stylesheet"/>
<link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect"/>
<link href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&amp;display=fallback" rel="stylesheet"/>
<style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
<link href="../assets/_mkdocstrings.css" rel="stylesheet"/>
<script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
</head>
<body data-md-color-accent="amber" data-md-color-primary="red" data-md-color-scheme="slate" dir="ltr">
<input autocomplete="off" class="md-toggle" data-md-toggle="drawer" id="__drawer" type="checkbox"/>
<input autocomplete="off" class="md-toggle" data-md-toggle="search" id="__search" type="checkbox"/>
<label class="md-overlay" for="__drawer"></label>
<div data-md-component="skip">
<a class="md-skip" href="#api">
          Skip to content
        </a>
</div>
<div data-md-component="announce">
</div>
<header class="md-header md-header--shadow md-header--lifted" data-md-component="header">
<nav aria-label="Header" class="md-header__inner md-grid">
<a aria-label="VinoDB" class="md-header__button md-logo" data-md-component="logo" href=".." title="VinoDB">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"></path></svg>
</a>
<label class="md-header__button md-icon" for="__drawer">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"></path></svg>
</label>
<div class="md-header__title" data-md-component="header-title">
<div class="md-header__ellipsis">
<div class="md-header__topic">
<span class="md-ellipsis">
            VinoDB
          </span>
</div>
<div class="md-header__topic" data-md-component="header-topic">
<span class="md-ellipsis">
            
              API
            
          </span>
</div>
</div>
</div>
<form class="md-header__option" data-md-component="palette">
<input aria-label="Switch to light mode" class="md-option" data-md-color-accent="amber" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-primary="red" data-md-color-scheme="slate" id="__palette_0" name="__palette" type="radio"/>
<label class="md-header__button md-icon" for="__palette_1" hidden="" title="Switch to light mode">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5m0 8a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3Z"></path></svg>
</label>
<input aria-label="Switch to dark mode" class="md-option" data-md-color-accent="amber" data-md-color-media="(prefers-color-scheme: light)" data-md-color-primary="red" data-md-color-scheme="default" id="__palette_1" name="__palette" type="radio"/>
<label class="md-header__button md-icon" for="__palette_0" hidden="" title="Switch to dark mode">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M17 6H7c-3.31 0-6 2.69-6 6s2.69 6 6 6h10c3.31 0 6-2.69 6-6s-2.69-6-6-6zm0 10H7c-2.21 0-4-1.79-4-4s1.79-4 4-4h10c2.21 0 4 1.79 4 4s-1.79 4-4 4zM7 9c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z"></path></svg>
</label>
</form>
<script>var media,input,key,value,palette=__md_get("__palette");if(palette&&palette.color){"(prefers-color-scheme)"===palette.color.media&&(media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']"),palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent"));for([key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
<label class="md-header__button md-icon" for="__search">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"></path></svg>
</label>
<div class="md-search" data-md-component="search" role="dialog">
<label class="md-search__overlay" for="__search"></label>
<div class="md-search__inner" role="search">
<form class="md-search__form" name="search">
<input aria-label="Search" autocapitalize="off" autocomplete="off" autocorrect="off" class="md-search__input" data-md-component="search-query" name="query" placeholder="Search" required="" spellcheck="false" type="text"/>
<label class="md-search__icon md-icon" for="__search">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"></path></svg>
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"></path></svg>
</label>
<nav aria-label="Search" class="md-search__options">
<button aria-label="Clear" class="md-search__icon md-icon" tabindex="-1" title="Clear" type="reset">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"></path></svg>
</button>
</nav>
</form>
<div class="md-search__output">
<div class="md-search__scrollwrap" data-md-scrollfix="">
<div class="md-search-result" data-md-component="search-result">
<div class="md-search-result__meta">
            Initializing search
          </div>
<ol class="md-search-result__list" role="presentation"></ol>
</div>
</div>
</div>
</div>
</div>
</nav>
<nav aria-label="Tabs" class="md-tabs" data-md-component="tabs">
<div class="md-grid">
<ul class="md-tabs__list">
<li class="md-tabs__item">
<a class="md-tabs__link" href="..">
        
  
    
  
  Home

      </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link" href="../projectoverview/">
        
  
    
  
  Project Overview

      </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link" href="../database/">
        
  
    
  
  Database

      </a>
</li>
<li class="md-tabs__item md-tabs__item--active">
<a class="md-tabs__link" href="./">
        
  
    
  
  API

      </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link" href="../testing/">
        
  
    
  
  Testing

      </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link" href="../swagger_ui/">
        
  
    
  
  SwaggerUI

      </a>
</li>
</ul>
</div>
</nav>
</header>
<div class="md-container" data-md-component="container">
<main class="md-main" data-md-component="main">
<div class="md-main__inner md-grid">
<div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav aria-label="Navigation" class="md-nav md-nav--primary md-nav--lifted" data-md-level="0">
<label class="md-nav__title" for="__drawer">
<a aria-label="VinoDB" class="md-nav__button md-logo" data-md-component="logo" href=".." title="VinoDB">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"></path></svg>
</a>
    VinoDB
  </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="..">
<span class="md-ellipsis">
    Home
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../projectoverview/">
<span class="md-ellipsis">
    Project Overview
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../database/">
<span class="md-ellipsis">
    Database
  </span>
</a>
</li>
<li class="md-nav__item md-nav__item--active">
<input class="md-nav__toggle md-toggle" id="__toc" type="checkbox"/>
<label class="md-nav__link md-nav__link--active" for="__toc">
<span class="md-ellipsis">
    API
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<a class="md-nav__link md-nav__link--active" href="./">
<span class="md-ellipsis">
    API
  </span>
</a>
<nav aria-label="Table of contents" class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">
<span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
<ul class="md-nav__list" data-md-component="toc" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="#api-configuration">
<span class="md-ellipsis">
      API configuration
    </span>
</a>
<nav aria-label="API configuration" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#getting-started">
<span class="md-ellipsis">
      Getting Started
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#structure-api">
<span class="md-ellipsis">
      Structure API
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#users">
<span class="md-ellipsis">
      users
    </span>
</a>
<nav aria-label="users" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#src.api.routers.users_router">
<span class="md-ellipsis">
      users_router
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#src.api.routers.users_router.add_user">
<span class="md-ellipsis">
      add_user
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#src.api.routers.users_router.delete_user">
<span class="md-ellipsis">
      delete_user
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#src.api.routers.users_router.get_extended_access_token">
<span class="md-ellipsis">
      get_extended_access_token
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#src.api.routers.users_router.get_users">
<span class="md-ellipsis">
      get_users
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#src.api.routers.users_router.update_user">
<span class="md-ellipsis">
      update_user
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#cellar">
<span class="md-ellipsis">
      cellar
    </span>
</a>
<nav aria-label="cellar" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#src.api.routers.cellar_router">
<span class="md-ellipsis">
      cellar_router
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#src.api.routers.cellar_router.add_a_rating">
<span class="md-ellipsis">
      add_a_rating
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#src.api.routers.cellar_router.add_wine_to_cellar">
<span class="md-ellipsis">
      add_wine_to_cellar
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#src.api.routers.cellar_router.delete_storage_unit">
<span class="md-ellipsis">
      delete_storage_unit
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#src.api.routers.cellar_router.move_bottle_to_other_storage">
<span class="md-ellipsis">
      move_bottle_to_other_storage
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#src.api.routers.cellar_router.post_storage_unit">
<span class="md-ellipsis">
      post_storage_unit
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#src.api.routers.cellar_router.remove_consumed_from_stock">
<span class="md-ellipsis">
      remove_consumed_from_stock
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#cellar_views">
<span class="md-ellipsis">
      cellar_views
    </span>
</a>
<nav aria-label="cellar_views" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#src.api.routers.cellar_views_router">
<span class="md-ellipsis">
      cellar_views_router
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#src.api.routers.cellar_views_router.get_bottle_open_window">
<span class="md-ellipsis">
      get_bottle_open_window
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#src.api.routers.cellar_views_router.get_owners">
<span class="md-ellipsis">
      get_owners
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#src.api.routers.cellar_views_router.get_stock_on_bottle">
<span class="md-ellipsis">
      get_stock_on_bottle
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#src.api.routers.cellar_views_router.get_storage_units">
<span class="md-ellipsis">
      get_storage_units
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#src.api.routers.cellar_views_router.get_wine_rating">
<span class="md-ellipsis">
      get_wine_rating
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#src.api.routers.cellar_views_router.get_your_bottles">
<span class="md-ellipsis">
      get_your_bottles
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#src.api.routers.cellar_views_router.get_your_ratings">
<span class="md-ellipsis">
      get_your_ratings
    </span>
</a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#api-choices">
<span class="md-ellipsis">
      API choices
    </span>
</a>
<nav aria-label="API choices" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#fastapi">
<span class="md-ellipsis">
      FastAPI
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#partition-key-and-id-in-the-cosmos-db">
<span class="md-ellipsis">
      Partition Key and ID in the cosmos DB
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#authentication">
<span class="md-ellipsis">
      Authentication
    </span>
</a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../testing/">
<span class="md-ellipsis">
    Testing
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../swagger_ui/">
<span class="md-ellipsis">
    SwaggerUI
  </span>
</a>
</li>
</ul>
</nav>
</div>
</div>
</div>
<div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav aria-label="Table of contents" class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">
<span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
<ul class="md-nav__list" data-md-component="toc" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="#api-configuration">
<span class="md-ellipsis">
      API configuration
    </span>
</a>
<nav aria-label="API configuration" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#getting-started">
<span class="md-ellipsis">
      Getting Started
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#structure-api">
<span class="md-ellipsis">
      Structure API
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#users">
<span class="md-ellipsis">
      users
    </span>
</a>
<nav aria-label="users" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#src.api.routers.users_router">
<span class="md-ellipsis">
      users_router
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#src.api.routers.users_router.add_user">
<span class="md-ellipsis">
      add_user
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#src.api.routers.users_router.delete_user">
<span class="md-ellipsis">
      delete_user
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#src.api.routers.users_router.get_extended_access_token">
<span class="md-ellipsis">
      get_extended_access_token
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#src.api.routers.users_router.get_users">
<span class="md-ellipsis">
      get_users
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#src.api.routers.users_router.update_user">
<span class="md-ellipsis">
      update_user
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#cellar">
<span class="md-ellipsis">
      cellar
    </span>
</a>
<nav aria-label="cellar" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#src.api.routers.cellar_router">
<span class="md-ellipsis">
      cellar_router
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#src.api.routers.cellar_router.add_a_rating">
<span class="md-ellipsis">
      add_a_rating
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#src.api.routers.cellar_router.add_wine_to_cellar">
<span class="md-ellipsis">
      add_wine_to_cellar
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#src.api.routers.cellar_router.delete_storage_unit">
<span class="md-ellipsis">
      delete_storage_unit
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#src.api.routers.cellar_router.move_bottle_to_other_storage">
<span class="md-ellipsis">
      move_bottle_to_other_storage
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#src.api.routers.cellar_router.post_storage_unit">
<span class="md-ellipsis">
      post_storage_unit
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#src.api.routers.cellar_router.remove_consumed_from_stock">
<span class="md-ellipsis">
      remove_consumed_from_stock
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#cellar_views">
<span class="md-ellipsis">
      cellar_views
    </span>
</a>
<nav aria-label="cellar_views" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#src.api.routers.cellar_views_router">
<span class="md-ellipsis">
      cellar_views_router
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#src.api.routers.cellar_views_router.get_bottle_open_window">
<span class="md-ellipsis">
      get_bottle_open_window
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#src.api.routers.cellar_views_router.get_owners">
<span class="md-ellipsis">
      get_owners
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#src.api.routers.cellar_views_router.get_stock_on_bottle">
<span class="md-ellipsis">
      get_stock_on_bottle
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#src.api.routers.cellar_views_router.get_storage_units">
<span class="md-ellipsis">
      get_storage_units
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#src.api.routers.cellar_views_router.get_wine_rating">
<span class="md-ellipsis">
      get_wine_rating
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#src.api.routers.cellar_views_router.get_your_bottles">
<span class="md-ellipsis">
      get_your_bottles
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#src.api.routers.cellar_views_router.get_your_ratings">
<span class="md-ellipsis">
      get_your_ratings
    </span>
</a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#api-choices">
<span class="md-ellipsis">
      API choices
    </span>
</a>
<nav aria-label="API choices" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#fastapi">
<span class="md-ellipsis">
      FastAPI
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#partition-key-and-id-in-the-cosmos-db">
<span class="md-ellipsis">
      Partition Key and ID in the cosmos DB
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#authentication">
<span class="md-ellipsis">
      Authentication
    </span>
</a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</div>
</div>
</div>
<div class="md-content" data-md-component="content">
<article class="md-content__inner md-typeset">
<h1 id="api">API</h1>
<h2 id="api-configuration"><strong>API configuration</strong></h2>
<h3 id="getting-started"><em>Getting Started</em></h3>
<ol>
<li>
<p>Run the live server </p>
<div class="highlight"><pre><span></span><code>uvicorn<span class="w"> </span>src.api.main:app<span class="w"> </span>--reload<span class="w"> </span>
</code></pre></div>
</li>
<li>
<p>Open the Swagger UI</p>
<div class="highlight"><pre><span></span><code>http://127.0.0.01:8000/login
</code></pre></div>
</li>
</ol>
<h3 id="structure-api"><em>Structure API</em></h3>
<table>
<thead>
<tr>
<th>Folder</th>
<th>Python file</th>
<th>Contents</th>
</tr>
</thead>
<tbody>
<tr>
<td>src/api/</td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td>main</td>
<td>An instance of the class FastAPI is created and routers are linked.</td>
</tr>
<tr>
<td></td>
<td>constants</td>
<td>Defining of constant values</td>
</tr>
<tr>
<td></td>
<td>dependencies</td>
<td>Dependency injection</td>
</tr>
<tr>
<td>src/api/routers</td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td>users_router</td>
<td>A...</td>
</tr>
<tr>
<td></td>
<td>cellar_router</td>
<td>...</td>
</tr>
<tr>
<td></td>
<td>cellar_views_router</td>
<td>...</td>
</tr>
</tbody>
</table>
<h3 id="users"><em>users</em></h3>
<div class="doc doc-object doc-module">
<a id="src.api.routers.users_router"></a>
<div class="doc doc-contents first">
<div class="doc doc-children">
<div class="doc doc-object doc-function">
<h4 class="doc doc-heading" id="src.api.routers.users_router.add_user">
<code class="highlight language-python"><span class="n">add_user</span><span class="p">(</span><span class="n">user_db</span><span class="p">,</span> <span class="n">owner_data</span><span class="p">)</span></code>
<span class="doc doc-labels">
<small class="doc doc-label doc-label-async"><code>async</code></small>
</span>
</h4>
<div class="doc doc-contents">
<p>ADMIN ONLY ENDPOINT
Add new wine/beer owner to the DB.
Required scope(s): USERS:READ, USERS:WRITE</p>
<details class="quote">
<summary>Source code in <code>src/api/routers/users_router.py</code></summary>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@router</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s1">'/add'</span><span class="p">,</span> <span class="n">dependencies</span><span class="o">=</span><span class="p">[</span><span class="n">Security</span><span class="p">(</span><span class="n">get_current_active_user</span><span class="p">,</span> <span class="n">scopes</span><span class="o">=</span><span class="p">[</span><span class="s1">'USERS:WRITE'</span><span class="p">])])</span>
<span class="k">async</span> <span class="k">def</span> <span class="nf">add_user</span><span class="p">(</span><span class="n">user_db</span><span class="p">:</span> <span class="n">Annotated</span><span class="p">[</span><span class="n">JdbcDbConn</span><span class="p">,</span> <span class="n">Depends</span><span class="p">(</span><span class="n">DB_CONN</span><span class="p">)],</span>
                   <span class="n">owner_data</span><span class="p">:</span> <span class="n">NewOwnerModel</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""</span>
<span class="sd">    ADMIN ONLY ENDPOINT</span>
<span class="sd">    Add new wine/beer owner to the DB.</span>
<span class="sd">    Required scope(s): USERS:READ, USERS:WRITE</span>
<span class="sd">    """</span>
    <span class="c1"># validate if user exists based on the unique username</span>
    <span class="n">user</span> <span class="o">=</span> <span class="n">user_db</span><span class="o">.</span><span class="n">execute_query_select</span><span class="p">(</span><span class="n">query</span><span class="o">=</span><span class="s2">"SELECT * FROM cellar.owners WHERE username = </span><span class="si">%(username)s</span><span class="s2">"</span><span class="p">,</span>
                                        <span class="n">params</span><span class="o">=</span><span class="p">{</span><span class="s2">"username"</span><span class="p">:</span> <span class="n">owner_data</span><span class="o">.</span><span class="n">username</span><span class="p">})</span>
    <span class="k">if</span> <span class="n">user</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">HTTPException</span><span class="p">(</span><span class="n">status_code</span><span class="o">=</span><span class="mi">400</span><span class="p">,</span> <span class="n">detail</span><span class="o">=</span><span class="sa">f</span><span class="s2">"A user with username </span><span class="si">{</span><span class="n">owner_data</span><span class="o">.</span><span class="n">username</span><span class="si">}</span><span class="s2"> already exists"</span><span class="p">)</span>
    <span class="n">user_db</span><span class="o">.</span><span class="n">execute_query</span><span class="p">(</span><span class="s2">"INSERT INTO cellar.owners (name, username, password, scopes, is_admin, enabled) "</span>
                          <span class="s2">"VALUES (</span><span class="si">%(name)s</span><span class="s2">, </span><span class="si">%(username)s</span><span class="s2">, </span><span class="si">%(password)s</span><span class="s2">, </span><span class="si">%(scopes)s</span><span class="s2">, </span><span class="si">%(is_admin)s</span><span class="s2">, "</span>
                          <span class="s2">"        </span><span class="si">%(enabled)s</span><span class="s2">)"</span><span class="p">,</span>
                          <span class="n">params</span><span class="o">=</span><span class="p">{</span><span class="s2">"name"</span><span class="p">:</span> <span class="n">owner_data</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="s2">"username"</span><span class="p">:</span> <span class="n">owner_data</span><span class="o">.</span><span class="n">username</span><span class="p">,</span>
                                  <span class="s2">"password"</span><span class="p">:</span> <span class="n">get_password_hash</span><span class="p">(</span><span class="n">password</span><span class="o">=</span><span class="n">owner_data</span><span class="o">.</span><span class="n">password</span><span class="p">),</span>
                                  <span class="s2">"scopes"</span><span class="p">:</span> <span class="n">owner_data</span><span class="o">.</span><span class="n">scopes</span><span class="p">,</span> <span class="s2">"is_admin"</span><span class="p">:</span> <span class="n">owner_data</span><span class="o">.</span><span class="n">is_admin</span><span class="p">,</span>
                                  <span class="s2">"enabled"</span><span class="p">:</span> <span class="n">owner_data</span><span class="o">.</span><span class="n">enabled</span><span class="p">})</span>
    <span class="k">return</span> <span class="sa">f</span><span class="s2">"User with username </span><span class="si">{</span><span class="n">owner_data</span><span class="o">.</span><span class="n">username</span><span class="si">}</span><span class="s2"> has successfully been added to the DB"</span>
</code></pre></div></td></tr></table></div>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h4 class="doc doc-heading" id="src.api.routers.users_router.delete_user">
<code class="highlight language-python"><span class="n">delete_user</span><span class="p">(</span><span class="n">user_db</span><span class="p">,</span> <span class="n">delete_username</span><span class="p">)</span></code>
<span class="doc doc-labels">
<small class="doc doc-label doc-label-async"><code>async</code></small>
</span>
</h4>
<div class="doc doc-contents">
<p>ADMIN ONLY ENDPOINT
Delete existing wine/beer owner to the DB.
Required scope(s): USERS:READ, USERS:WRITE</p>
<details class="quote">
<summary>Source code in <code>src/api/routers/users_router.py</code></summary>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@router</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="s1">'/delete'</span><span class="p">,</span> <span class="n">dependencies</span><span class="o">=</span><span class="p">[</span><span class="n">Security</span><span class="p">(</span><span class="n">get_current_active_user</span><span class="p">,</span> <span class="n">scopes</span><span class="o">=</span><span class="p">[</span><span class="s1">'USERS:WRITE'</span><span class="p">])])</span>
<span class="k">async</span> <span class="k">def</span> <span class="nf">delete_user</span><span class="p">(</span><span class="n">user_db</span><span class="p">:</span> <span class="n">Annotated</span><span class="p">[</span><span class="n">JdbcDbConn</span><span class="p">,</span> <span class="n">Depends</span><span class="p">(</span><span class="n">DB_CONN</span><span class="p">)],</span>
                      <span class="n">delete_username</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""</span>
<span class="sd">    ADMIN ONLY ENDPOINT</span>
<span class="sd">    Delete existing wine/beer owner to the DB.</span>
<span class="sd">    Required scope(s): USERS:READ, USERS:WRITE</span>
<span class="sd">    """</span>
    <span class="c1"># validate if user exists based on the unique username</span>
    <span class="n">user</span> <span class="o">=</span> <span class="n">user_db</span><span class="o">.</span><span class="n">execute_query_select</span><span class="p">(</span><span class="n">query</span><span class="o">=</span><span class="s2">"SELECT * FROM cellar.owners WHERE username = </span><span class="si">%(username)s</span><span class="s2">"</span><span class="p">,</span>
                                        <span class="n">params</span><span class="o">=</span><span class="p">{</span><span class="s2">"username"</span><span class="p">:</span> <span class="n">delete_username</span><span class="p">})</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">user</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">HTTPException</span><span class="p">(</span><span class="n">status_code</span><span class="o">=</span><span class="mi">400</span><span class="p">,</span> <span class="n">detail</span><span class="o">=</span><span class="sa">f</span><span class="s2">"No users with username </span><span class="si">{</span><span class="n">delete_username</span><span class="si">}</span><span class="s2"> exist"</span><span class="p">)</span>
    <span class="n">user_db</span><span class="o">.</span><span class="n">execute_query</span><span class="p">(</span><span class="s2">"DELETE FROM cellar.owners WHERE username = </span><span class="si">%(username)s</span><span class="s2">"</span><span class="p">,</span>
                          <span class="n">params</span><span class="o">=</span><span class="p">{</span><span class="s2">"username"</span><span class="p">:</span> <span class="n">delete_username</span><span class="p">})</span>
    <span class="k">return</span> <span class="sa">f</span><span class="s2">"User with username </span><span class="si">{</span><span class="n">delete_username</span><span class="si">}</span><span class="s2"> has successfully been removed from the DB"</span>
</code></pre></div></td></tr></table></div>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h4 class="doc doc-heading" id="src.api.routers.users_router.get_extended_access_token">
<code class="highlight language-python"><span class="n">get_extended_access_token</span><span class="p">(</span><span class="n">user_db</span><span class="p">,</span> <span class="n">token_user</span><span class="p">,</span> <span class="n">scopes</span><span class="p">,</span> <span class="n">days_valid</span><span class="p">)</span></code>
<span class="doc doc-labels">
<small class="doc doc-label doc-label-async"><code>async</code></small>
</span>
</h4>
<div class="doc doc-contents">
<p>ADMIN ONLY ENDPOINT
Generate an access token with extended expiration date of up to a year. The token can be generated for any user in
the database. Only scopes that the intended user is allowed to use can be added to this token.
Required scope(s): USERS:READ, USERS:WRITE</p>
<details class="quote">
<summary>Source code in <code>src/api/routers/users_router.py</code></summary>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@router</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="s1">'/extendedtoken'</span><span class="p">,</span> <span class="n">response_model</span><span class="o">=</span><span class="n">Token</span><span class="p">,</span>
             <span class="n">dependencies</span><span class="o">=</span><span class="p">[</span><span class="n">Security</span><span class="p">(</span><span class="n">get_current_active_user</span><span class="p">,</span> <span class="n">scopes</span><span class="o">=</span><span class="p">[</span><span class="s1">'USERS:WRITE'</span><span class="p">])])</span>
<span class="k">async</span> <span class="k">def</span> <span class="nf">get_extended_access_token</span><span class="p">(</span><span class="n">user_db</span><span class="p">:</span> <span class="n">Annotated</span><span class="p">[</span><span class="n">JdbcDbConn</span><span class="p">,</span> <span class="n">Depends</span><span class="p">(</span><span class="n">DB_CONN</span><span class="p">)],</span>
                                    <span class="n">token_user</span><span class="p">:</span> <span class="n">Annotated</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Form</span><span class="p">()],</span>
                                    <span class="n">scopes</span><span class="p">:</span> <span class="n">Annotated</span><span class="p">[</span><span class="nb">list</span><span class="p">[</span><span class="n">SCOPES_ENUM</span><span class="p">],</span> <span class="n">Form</span><span class="p">()],</span>
                                    <span class="n">days_valid</span><span class="p">:</span> <span class="n">Annotated</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">Form</span><span class="p">(</span><span class="o">...</span><span class="p">,</span> <span class="n">ge</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">le</span><span class="o">=</span><span class="mi">365</span><span class="p">)]):</span>
<span class="w">    </span><span class="sd">"""</span>
<span class="sd">    ADMIN ONLY ENDPOINT</span>
<span class="sd">    Generate an access token with extended expiration date of up to a year. The token can be generated for any user in</span>
<span class="sd">    the database. Only scopes that the intended user is allowed to use can be added to this token.</span>
<span class="sd">    Required scope(s): USERS:READ, USERS:WRITE</span>
<span class="sd">    """</span>
    <span class="n">token_user_model</span> <span class="o">=</span> <span class="n">get_user</span><span class="p">(</span><span class="n">username</span><span class="o">=</span><span class="n">token_user</span><span class="p">,</span> <span class="n">user_db</span><span class="o">=</span><span class="n">user_db</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">token_user_model</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">HTTPException</span><span class="p">(</span><span class="n">status_code</span><span class="o">=</span><span class="n">status</span><span class="o">.</span><span class="n">HTTP_404_NOT_FOUND</span><span class="p">,</span> <span class="n">detail</span><span class="o">=</span><span class="sa">f</span><span class="s1">'User </span><span class="si">{</span><span class="n">token_user</span><span class="si">}</span><span class="s1"> does not exist.'</span><span class="p">)</span>
    <span class="n">access_token_expires</span> <span class="o">=</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="n">days_valid</span><span class="p">)</span>
    <span class="n">access_token</span> <span class="o">=</span> <span class="n">create_access_token</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="p">{</span><span class="s1">'sub'</span><span class="p">:</span> <span class="n">token_user_model</span><span class="o">.</span><span class="n">username</span><span class="p">,</span>
                                             <span class="s1">'scopes'</span><span class="p">:</span> <span class="n">verify_scopes</span><span class="p">(</span><span class="n">scopes</span><span class="o">=</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">value</span><span class="p">)</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">scopes</span><span class="p">],</span>
                                                                     <span class="n">user_scopes</span><span class="o">=</span><span class="n">token_user_model</span><span class="o">.</span><span class="n">scopes</span><span class="p">,</span>
                                                                     <span class="n">is_admin</span><span class="o">=</span><span class="n">token_user_model</span><span class="o">.</span><span class="n">is_admin</span><span class="p">)},</span>
                                       <span class="n">expires_delta</span><span class="o">=</span><span class="n">access_token_expires</span><span class="p">)</span>

    <span class="k">return</span> <span class="p">{</span><span class="s1">'access_token'</span><span class="p">:</span> <span class="n">access_token</span><span class="p">,</span> <span class="s1">'token_type'</span><span class="p">:</span> <span class="s1">'bearer'</span><span class="p">}</span>
</code></pre></div></td></tr></table></div>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h4 class="doc doc-heading" id="src.api.routers.users_router.get_users">
<code class="highlight language-python"><span class="n">get_users</span><span class="p">(</span><span class="n">user_db</span><span class="p">)</span></code>
<span class="doc doc-labels">
<small class="doc doc-label doc-label-async"><code>async</code></small>
</span>
</h4>
<div class="doc doc-contents">
<p>Retrieve all registered wine/beer owners.
Required scope(s): CELLAR:READ</p>
<details class="quote">
<summary>Source code in <code>src/api/routers/users_router.py</code></summary>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@router</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">'/get_users'</span><span class="p">,</span> <span class="n">response_model</span><span class="o">=</span><span class="nb">list</span><span class="p">[</span><span class="n">OwnerModel</span><span class="p">],</span> <span class="n">dependencies</span><span class="o">=</span><span class="p">[</span><span class="n">Security</span><span class="p">(</span><span class="n">get_current_active_user</span><span class="p">)])</span>
<span class="k">async</span> <span class="k">def</span> <span class="nf">get_users</span><span class="p">(</span><span class="n">user_db</span><span class="p">:</span> <span class="n">Annotated</span><span class="p">[</span><span class="n">JdbcDbConn</span><span class="p">,</span> <span class="n">Depends</span><span class="p">(</span><span class="n">DB_CONN</span><span class="p">)])</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">OwnerModel</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">"""</span>
<span class="sd">    Retrieve all registered wine/beer owners.</span>
<span class="sd">    Required scope(s): CELLAR:READ</span>
<span class="sd">    """</span>
    <span class="k">return</span> <span class="n">user_db</span><span class="o">.</span><span class="n">execute_query_select</span><span class="p">(</span><span class="n">query</span><span class="o">=</span><span class="s2">"SELECT id, name, username, scopes, is_admin, enabled "</span>
                                              <span class="s2">"FROM cellar.owners"</span><span class="p">,</span>
                                        <span class="n">get_fields</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h4 class="doc doc-heading" id="src.api.routers.users_router.update_user">
<code class="highlight language-python"><span class="n">update_user</span><span class="p">(</span><span class="n">user_db</span><span class="p">,</span> <span class="n">new_data</span><span class="p">,</span> <span class="n">current_username</span><span class="p">)</span></code>
<span class="doc doc-labels">
<small class="doc doc-label doc-label-async"><code>async</code></small>
</span>
</h4>
<div class="doc doc-contents">
<p>ADMIN ONLY ENDPOINT
Updates existing wine/beer owner in the DB.
Required scope(s): USERS:READ, USERS:WRITE</p>
<details class="quote">
<summary>Source code in <code>src/api/routers/users_router.py</code></summary>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@router</span><span class="o">.</span><span class="n">patch</span><span class="p">(</span><span class="s1">'/update'</span><span class="p">,</span> <span class="n">dependencies</span><span class="o">=</span><span class="p">[</span><span class="n">Security</span><span class="p">(</span><span class="n">get_current_active_user</span><span class="p">,</span> <span class="n">scopes</span><span class="o">=</span><span class="p">[</span><span class="s1">'USERS:WRITE'</span><span class="p">])])</span>
<span class="k">async</span> <span class="k">def</span> <span class="nf">update_user</span><span class="p">(</span><span class="n">user_db</span><span class="p">:</span> <span class="n">Annotated</span><span class="p">[</span><span class="n">JdbcDbConn</span><span class="p">,</span> <span class="n">Depends</span><span class="p">(</span><span class="n">DB_CONN</span><span class="p">)],</span>
                      <span class="n">new_data</span><span class="p">:</span> <span class="n">UpdateOwnerModel</span><span class="p">,</span>
                      <span class="n">current_username</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""</span>
<span class="sd">    ADMIN ONLY ENDPOINT</span>
<span class="sd">    Updates existing wine/beer owner in the DB.</span>
<span class="sd">    Required scope(s): USERS:READ, USERS:WRITE</span>
<span class="sd">    """</span>

    <span class="c1"># Validate whether the new username exists and if so, if it exists in the DB</span>
    <span class="n">new_user</span> <span class="o">=</span> <span class="n">user_db</span><span class="o">.</span><span class="n">execute_query_select</span><span class="p">(</span><span class="n">query</span><span class="o">=</span><span class="s2">"SELECT * FROM cellar.owners WHERE username = </span><span class="si">%(username)s</span><span class="s2">"</span><span class="p">,</span>
                                            <span class="n">params</span><span class="o">=</span><span class="p">{</span><span class="s2">"username"</span><span class="p">:</span> <span class="n">new_data</span><span class="o">.</span><span class="n">username</span><span class="p">},</span>
                                            <span class="n">get_fields</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">new_user</span><span class="p">)</span> <span class="ow">and</span> <span class="n">new_user</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">'username'</span><span class="p">]</span> <span class="o">!=</span> <span class="n">current_username</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">HTTPException</span><span class="p">(</span><span class="n">status_code</span><span class="o">=</span><span class="mi">400</span><span class="p">,</span> <span class="n">detail</span><span class="o">=</span><span class="sa">f</span><span class="s2">"Users with username </span><span class="si">{</span><span class="n">new_user</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">'username'</span><span class="p">]</span><span class="si">}</span><span class="s2"> exist. Please "</span>
                                                    <span class="sa">f</span><span class="s2">"provide a unique new username."</span><span class="p">)</span>

    <span class="c1"># Find updated values and construct query string</span>
    <span class="n">update_fields</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">new_data</span><span class="o">.</span><span class="n">dict</span><span class="p">(</span><span class="n">exclude_unset</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="k">if</span> <span class="n">k</span> <span class="o">==</span> <span class="s2">"password"</span><span class="p">:</span>
            <span class="c1"># Hash the new password</span>
            <span class="n">update_fields</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">get_password_hash</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">update_fields</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span>

    <span class="n">updated_fields</span> <span class="o">=</span> <span class="s2">", "</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">field</span><span class="si">}</span><span class="s2"> = %(</span><span class="si">{</span><span class="n">field</span><span class="si">}</span><span class="s2">)s"</span> <span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="n">update_fields</span><span class="p">)</span>
    <span class="n">user_db</span><span class="o">.</span><span class="n">execute_query</span><span class="p">(</span><span class="sa">f</span><span class="s2">"UPDATE cellar.owners SET </span><span class="si">{</span><span class="n">updated_fields</span><span class="si">}</span><span class="s2"> WHERE username = %(current_username)s"</span><span class="p">,</span>
                          <span class="n">params</span><span class="o">=</span><span class="p">{</span><span class="s2">"current_username"</span><span class="p">:</span> <span class="n">current_username</span><span class="p">,</span> <span class="o">**</span><span class="n">update_fields</span><span class="p">})</span>

    <span class="k">return</span> <span class="s2">"User information updated successfully."</span>
</code></pre></div></td></tr></table></div>
</details>
</div>
</div>
</div>
</div>
</div><h3 id="cellar"><em>cellar</em></h3>
<div class="doc doc-object doc-module">
<a id="src.api.routers.cellar_router"></a>
<div class="doc doc-contents first">
<div class="doc doc-children">
<div class="doc doc-object doc-function">
<h4 class="doc doc-heading" id="src.api.routers.cellar_router.add_a_rating">
<code class="highlight language-python"><span class="n">add_a_rating</span><span class="p">(</span><span class="n">db_conn</span><span class="p">,</span> <span class="n">current_user</span><span class="p">,</span> <span class="n">wine_id</span><span class="p">,</span> <span class="n">rating</span><span class="p">)</span></code>
<span class="doc doc-labels">
<small class="doc doc-label doc-label-async"><code>async</code></small>
</span>
</h4>
<div class="doc doc-contents">
<p>Adds a rating to your DB. Note that if you've drunk a bottle, you can make use of the '/wine_in_cellar/consumed'
endpoint to both add a rating and update your storage.</p>
<p>Required scope(s): CELLAR:READ, CELLAR:WRITE</p>
<details class="quote">
<summary>Source code in <code>src/api/routers/cellar_router.py</code></summary>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@router</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s2">"/wine_in_cellar/add_rating"</span><span class="p">,</span> <span class="n">dependencies</span><span class="o">=</span><span class="p">[</span><span class="n">Security</span><span class="p">(</span><span class="n">get_current_active_user</span><span class="p">)])</span>
<span class="k">async</span> <span class="k">def</span> <span class="nf">add_a_rating</span><span class="p">(</span><span class="n">db_conn</span><span class="p">:</span> <span class="n">Annotated</span><span class="p">[</span><span class="n">JdbcDbConn</span><span class="p">,</span> <span class="n">Depends</span><span class="p">(</span><span class="n">DB_CONN</span><span class="p">)],</span>
                       <span class="n">current_user</span><span class="p">:</span> <span class="n">Annotated</span><span class="p">[</span><span class="n">OwnerModel</span><span class="p">,</span> <span class="n">Depends</span><span class="p">(</span><span class="n">get_current_active_user</span><span class="p">)],</span>
                       <span class="n">wine_id</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
                       <span class="n">rating</span><span class="p">:</span> <span class="n">RatingModel</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""</span>
<span class="sd">    Adds a rating to your DB. Note that if you've drunk a bottle, you can make use of the '/wine_in_cellar/consumed'</span>
<span class="sd">    endpoint to both add a rating and update your storage.</span>

<span class="sd">    Required scope(s): CELLAR:READ, CELLAR:WRITE</span>
<span class="sd">    """</span>
    <span class="c1"># Verify the wine exists in the DB</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="k">await</span> <span class="n">wine_in_db</span><span class="p">(</span><span class="n">db_conn</span><span class="o">=</span><span class="n">db_conn</span><span class="p">,</span> <span class="n">wine_id</span><span class="o">=</span><span class="n">wine_id</span><span class="p">):</span>
        <span class="k">raise</span> <span class="n">HTTPException</span><span class="p">(</span><span class="n">status_code</span><span class="o">=</span><span class="n">status</span><span class="o">.</span><span class="n">HTTP_404_NOT_FOUND</span><span class="p">,</span>
                            <span class="n">detail</span><span class="o">=</span><span class="sa">f</span><span class="s2">"Wine with wine_id: </span><span class="si">{</span><span class="n">wine_id</span><span class="si">}</span><span class="s2"> is not found in the DB. Make sure to use an "</span>
                                   <span class="sa">f</span><span class="s2">"existing wine ID in order to rate the correct wine"</span><span class="p">)</span>
    <span class="k">await</span> <span class="n">add_rating_to_db</span><span class="p">(</span><span class="n">db_conn</span><span class="o">=</span><span class="n">db_conn</span><span class="p">,</span> <span class="n">user_id</span><span class="o">=</span><span class="n">current_user</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">wine_id</span><span class="o">=</span><span class="n">wine_id</span><span class="p">,</span> <span class="n">rating</span><span class="o">=</span><span class="n">rating</span><span class="p">)</span>
    <span class="k">return</span> <span class="s2">"Rating has successfully been added to the DB"</span>
</code></pre></div></td></tr></table></div>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h4 class="doc doc-heading" id="src.api.routers.cellar_router.add_wine_to_cellar">
<code class="highlight language-python"><span class="n">add_wine_to_cellar</span><span class="p">(</span><span class="n">db_conn</span><span class="p">,</span> <span class="n">current_user</span><span class="p">,</span> <span class="n">wine_data</span><span class="p">)</span></code>
<span class="doc doc-labels">
<small class="doc doc-label doc-label-async"><code>async</code></small>
</span>
</h4>
<div class="doc doc-contents">
<p>Adds bottles to your cellar. Make sure to provide the correct storage unit ID. You can check what storages you can
add wines to from the '/storages/get' endpoint.</p>
<p>Required scope(s): CELLAR:READ, CELLAR:WRITE</p>
<details class="quote">
<summary>Source code in <code>src/api/routers/cellar_router.py</code></summary>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span>
<span class="normal">84</span>
<span class="normal">85</span>
<span class="normal">86</span>
<span class="normal">87</span>
<span class="normal">88</span>
<span class="normal">89</span>
<span class="normal">90</span>
<span class="normal">91</span>
<span class="normal">92</span>
<span class="normal">93</span>
<span class="normal">94</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@router</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s2">"/wine_in_cellar/add"</span><span class="p">,</span> <span class="n">dependencies</span><span class="o">=</span><span class="p">[</span><span class="n">Security</span><span class="p">(</span><span class="n">get_current_active_user</span><span class="p">)])</span>
<span class="k">async</span> <span class="k">def</span> <span class="nf">add_wine_to_cellar</span><span class="p">(</span><span class="n">db_conn</span><span class="p">:</span> <span class="n">Annotated</span><span class="p">[</span><span class="n">JdbcDbConn</span><span class="p">,</span> <span class="n">Depends</span><span class="p">(</span><span class="n">DB_CONN</span><span class="p">)],</span>
                             <span class="n">current_user</span><span class="p">:</span> <span class="n">Annotated</span><span class="p">[</span><span class="n">OwnerModel</span><span class="p">,</span> <span class="n">Depends</span><span class="p">(</span><span class="n">get_current_active_user</span><span class="p">)],</span>
                             <span class="n">wine_data</span><span class="p">:</span> <span class="n">CellarInModel</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""</span>
<span class="sd">    Adds bottles to your cellar. Make sure to provide the correct storage unit ID. You can check what storages you can</span>
<span class="sd">    add wines to from the '/storages/get' endpoint.</span>

<span class="sd">    Required scope(s): CELLAR:READ, CELLAR:WRITE</span>
<span class="sd">    """</span>
    <span class="c1"># Check if storage unit is valid</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="k">await</span> <span class="n">verify_storage_exists_for_user</span><span class="p">(</span><span class="n">db_conn</span><span class="o">=</span><span class="n">db_conn</span><span class="p">,</span> <span class="n">storage_id</span><span class="o">=</span><span class="n">wine_data</span><span class="o">.</span><span class="n">storage_unit</span><span class="p">,</span>
                                                <span class="n">user_id</span><span class="o">=</span><span class="n">current_user</span><span class="o">.</span><span class="n">id</span><span class="p">):</span>
        <span class="k">raise</span> <span class="n">HTTPException</span><span class="p">(</span><span class="n">status_code</span><span class="o">=</span><span class="n">status</span><span class="o">.</span><span class="n">HTTP_404_NOT_FOUND</span><span class="p">,</span>
                            <span class="n">detail</span><span class="o">=</span><span class="s2">"Storage unit is not found for your particular user."</span><span class="p">)</span>

    <span class="c1"># Inspect if the wine is already in the wines table</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="k">await</span> <span class="n">verify_wine_in_db</span><span class="p">(</span><span class="n">db_conn</span><span class="o">=</span><span class="n">db_conn</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">wine_data</span><span class="o">.</span><span class="n">wine_info</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">vintage</span><span class="o">=</span><span class="n">wine_data</span><span class="o">.</span><span class="n">wine_info</span><span class="o">.</span><span class="n">vintage</span><span class="p">):</span>
        <span class="c1"># If not, add data to the wines table</span>
        <span class="k">await</span> <span class="n">add_wine_to_db</span><span class="p">(</span><span class="n">db_conn</span><span class="o">=</span><span class="n">db_conn</span><span class="p">,</span> <span class="n">wine_info</span><span class="o">=</span><span class="n">wine_data</span><span class="o">.</span><span class="n">wine_info</span><span class="p">)</span>

    <span class="c1"># Retrieve wine ID from the wines table</span>
    <span class="n">wine_id</span> <span class="o">=</span> <span class="k">await</span> <span class="n">get_bottle_id</span><span class="p">(</span><span class="n">db_conn</span><span class="o">=</span><span class="n">db_conn</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">wine_data</span><span class="o">.</span><span class="n">wine_info</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">vintage</span><span class="o">=</span><span class="n">wine_data</span><span class="o">.</span><span class="n">wine_info</span><span class="o">.</span><span class="n">vintage</span><span class="p">)</span>

    <span class="c1"># Insert all info into the cellar table</span>
    <span class="k">await</span> <span class="n">add_bottle_to_cellar</span><span class="p">(</span><span class="n">db_conn</span><span class="o">=</span><span class="n">db_conn</span><span class="p">,</span> <span class="n">wine_id</span><span class="o">=</span><span class="n">wine_id</span><span class="p">,</span> <span class="n">owner_id</span><span class="o">=</span><span class="n">current_user</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">wine_data</span><span class="o">=</span><span class="n">wine_data</span><span class="p">)</span>

    <span class="k">return</span> <span class="s2">"Bottle has successfully been added to the DB"</span>
</code></pre></div></td></tr></table></div>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h4 class="doc doc-heading" id="src.api.routers.cellar_router.delete_storage_unit">
<code class="highlight language-python"><span class="n">delete_storage_unit</span><span class="p">(</span><span class="n">db_conn</span><span class="p">,</span> <span class="n">current_user</span><span class="p">,</span> <span class="n">location</span><span class="p">,</span> <span class="n">description</span><span class="p">)</span></code>
<span class="doc doc-labels">
<small class="doc doc-label doc-label-async"><code>async</code></small>
</span>
</h4>
<div class="doc doc-contents">
<p>Delete a storage unit to the DB. Provide the location and description of the storage unit to select which unit
should be deleted. Make sure that the storage unit is empty whenever you want to remove it.</p>
<p>Required scope(s): CELLAR:READ, CELLAR:WRITE</p>
<details class="quote">
<summary>Source code in <code>src/api/routers/cellar_router.py</code></summary>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@router</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="s2">"/storages/delete"</span><span class="p">,</span> <span class="n">dependencies</span><span class="o">=</span><span class="p">[</span><span class="n">Security</span><span class="p">(</span><span class="n">get_current_active_user</span><span class="p">)])</span>
<span class="k">async</span> <span class="k">def</span> <span class="nf">delete_storage_unit</span><span class="p">(</span><span class="n">db_conn</span><span class="p">:</span> <span class="n">Annotated</span><span class="p">[</span><span class="n">JdbcDbConn</span><span class="p">,</span> <span class="n">Depends</span><span class="p">(</span><span class="n">DB_CONN</span><span class="p">)],</span>
                              <span class="n">current_user</span><span class="p">:</span> <span class="n">Annotated</span><span class="p">[</span><span class="n">OwnerModel</span><span class="p">,</span> <span class="n">Depends</span><span class="p">(</span><span class="n">get_current_active_user</span><span class="p">)],</span>
                              <span class="n">location</span><span class="p">:</span> <span class="n">Annotated</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Query</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">200</span><span class="p">)],</span>
                              <span class="n">description</span><span class="p">:</span> <span class="n">Annotated</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Query</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">200</span><span class="p">)])</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""</span>
<span class="sd">    Delete a storage unit to the DB. Provide the location and description of the storage unit to select which unit</span>
<span class="sd">    should be deleted. Make sure that the storage unit is empty whenever you want to remove it.</span>

<span class="sd">    Required scope(s): CELLAR:READ, CELLAR:WRITE</span>
<span class="sd">    """</span>
    <span class="c1"># Verify empty storage unit</span>
    <span class="n">storage_id</span> <span class="o">=</span> <span class="k">await</span> <span class="n">get_storage_id</span><span class="p">(</span><span class="n">db_conn</span><span class="o">=</span><span class="n">db_conn</span><span class="p">,</span> <span class="n">current_user_id</span><span class="o">=</span><span class="n">current_user</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
                                      <span class="n">location</span><span class="o">=</span><span class="n">location</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="n">description</span><span class="p">)</span>

    <span class="c1"># Remove the storage unit from DB if it is empty.</span>
    <span class="c1"># Note that `verify_empty_storage_unit` raises and error if the storage unit is not empty</span>
    <span class="k">if</span> <span class="k">await</span> <span class="n">verify_empty_storage_unit</span><span class="p">(</span><span class="n">db_conn</span><span class="o">=</span><span class="n">db_conn</span><span class="p">,</span> <span class="n">storage_id</span><span class="o">=</span><span class="n">storage_id</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
        <span class="n">db_conn</span><span class="o">.</span><span class="n">execute_query</span><span class="p">((</span><span class="s2">"DELETE FROM cellar.storages "</span>
                               <span class="s2">"WHERE location = </span><span class="si">%(location)s</span><span class="s2"> "</span>
                               <span class="s2">"  AND description = </span><span class="si">%(description)s</span><span class="s2"> "</span>
                               <span class="s2">"  AND owner_id = </span><span class="si">%(owner_id)s</span><span class="s2">"</span><span class="p">),</span>
                              <span class="n">params</span><span class="o">=</span><span class="p">{</span><span class="s2">"location"</span><span class="p">:</span> <span class="n">location</span><span class="p">,</span> <span class="s2">"description"</span><span class="p">:</span> <span class="n">description</span><span class="p">,</span> <span class="s2">"owner_id"</span><span class="p">:</span> <span class="n">current_user</span><span class="o">.</span><span class="n">id</span><span class="p">})</span>

    <span class="k">return</span> <span class="s2">"Storage unit has successfully been removed from the DB"</span>
</code></pre></div></td></tr></table></div>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h4 class="doc doc-heading" id="src.api.routers.cellar_router.move_bottle_to_other_storage">
<code class="highlight language-python"><span class="n">move_bottle_to_other_storage</span><span class="p">(</span><span class="n">db_conn</span><span class="p">,</span> <span class="n">current_user</span><span class="p">,</span> <span class="n">cellar_id</span><span class="p">,</span> <span class="n">new_storage_unit</span><span class="p">)</span></code>
<span class="doc doc-labels">
<small class="doc doc-label doc-label-async"><code>async</code></small>
</span>
</h4>
<div class="doc doc-contents">
<p>Move a bottle from one storage unit to another.</p>
<p>Required scope(s): CELLAR:READ, CELLAR:WRITE</p>
<details class="quote">
<summary>Source code in <code>src/api/routers/cellar_router.py</code></summary>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@router</span><span class="o">.</span><span class="n">patch</span><span class="p">(</span><span class="s2">"/wine_in_cellar/move"</span><span class="p">,</span> <span class="n">dependencies</span><span class="o">=</span><span class="p">[</span><span class="n">Security</span><span class="p">(</span><span class="n">get_current_active_user</span><span class="p">)])</span>
<span class="k">async</span> <span class="k">def</span> <span class="nf">move_bottle_to_other_storage</span><span class="p">(</span><span class="n">db_conn</span><span class="p">:</span> <span class="n">Annotated</span><span class="p">[</span><span class="n">JdbcDbConn</span><span class="p">,</span> <span class="n">Depends</span><span class="p">(</span><span class="n">DB_CONN</span><span class="p">)],</span>
                                       <span class="n">current_user</span><span class="p">:</span> <span class="n">Annotated</span><span class="p">[</span><span class="n">OwnerModel</span><span class="p">,</span> <span class="n">Depends</span><span class="p">(</span><span class="n">get_current_active_user</span><span class="p">)],</span>
                                       <span class="n">cellar_id</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
                                       <span class="n">new_storage_unit</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""</span>
<span class="sd">    Move a bottle from one storage unit to another.</span>

<span class="sd">    Required scope(s): CELLAR:READ, CELLAR:WRITE</span>
<span class="sd">    """</span>
    <span class="k">if</span> <span class="k">await</span> <span class="n">verify_storage_exists_for_user</span><span class="p">(</span><span class="n">db_conn</span><span class="o">=</span><span class="n">db_conn</span><span class="p">,</span> <span class="n">storage_id</span><span class="o">=</span><span class="n">new_storage_unit</span><span class="p">,</span> <span class="n">user_id</span><span class="o">=</span><span class="n">current_user</span><span class="o">.</span><span class="n">id</span><span class="p">):</span>
        <span class="n">db_conn</span><span class="o">.</span><span class="n">execute_query</span><span class="p">(</span><span class="s2">"UPDATE cellar.cellar SET storage_unit = </span><span class="si">%(storage_unit)s</span><span class="s2"> WHERE id = </span><span class="si">%(cellar_id)s</span><span class="s2">"</span><span class="p">,</span>
                              <span class="n">params</span><span class="o">=</span><span class="p">{</span><span class="s2">"storage_unit"</span><span class="p">:</span> <span class="n">new_storage_unit</span><span class="p">,</span> <span class="s2">"cellar_id"</span><span class="p">:</span> <span class="n">cellar_id</span><span class="p">})</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">"Bottle has successfully been transferred to storage unit </span><span class="si">{</span><span class="n">new_storage_unit</span><span class="si">}</span><span class="s2">"</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">HTTPException</span><span class="p">(</span><span class="n">status_code</span><span class="o">=</span><span class="n">status</span><span class="o">.</span><span class="n">HTTP_404_NOT_FOUND</span><span class="p">,</span>
                            <span class="n">detail</span><span class="o">=</span><span class="s2">"Storage unit is not found for your particular user."</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h4 class="doc doc-heading" id="src.api.routers.cellar_router.post_storage_unit">
<code class="highlight language-python"><span class="n">post_storage_unit</span><span class="p">(</span><span class="n">db_conn</span><span class="p">,</span> <span class="n">current_user</span><span class="p">,</span> <span class="n">storage_data</span><span class="p">)</span></code>
<span class="doc doc-labels">
<small class="doc doc-label doc-label-async"><code>async</code></small>
</span>
</h4>
<div class="doc doc-contents">
<p>Add a storage unit to the DB.</p>
<p>Required scope(s): CELLAR:READ, CELLAR:WRITE</p>
<details class="quote">
<summary>Source code in <code>src/api/routers/cellar_router.py</code></summary>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@router</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s2">"/storages/add"</span><span class="p">,</span> <span class="n">dependencies</span><span class="o">=</span><span class="p">[</span><span class="n">Security</span><span class="p">(</span><span class="n">get_current_active_user</span><span class="p">)])</span>
<span class="k">async</span> <span class="k">def</span> <span class="nf">post_storage_unit</span><span class="p">(</span><span class="n">db_conn</span><span class="p">:</span> <span class="n">Annotated</span><span class="p">[</span><span class="n">JdbcDbConn</span><span class="p">,</span> <span class="n">Depends</span><span class="p">(</span><span class="n">DB_CONN</span><span class="p">)],</span>
                            <span class="n">current_user</span><span class="p">:</span> <span class="n">Annotated</span><span class="p">[</span><span class="n">OwnerModel</span><span class="p">,</span> <span class="n">Depends</span><span class="p">(</span><span class="n">get_current_active_user</span><span class="p">)],</span>
                            <span class="n">storage_data</span><span class="p">:</span> <span class="n">StorageInModel</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""</span>
<span class="sd">    Add a storage unit to the DB.</span>

<span class="sd">    Required scope(s): CELLAR:READ, CELLAR:WRITE</span>
<span class="sd">    """</span>
    <span class="n">db_conn</span><span class="o">.</span><span class="n">execute_query</span><span class="p">((</span><span class="s2">"INSERT INTO cellar.storages (owner_id, location, description) "</span>
                           <span class="s2">"VALUES (</span><span class="si">%(owner_id)s</span><span class="s2">, </span><span class="si">%(location)s</span><span class="s2">, </span><span class="si">%(description)s</span><span class="s2">)"</span><span class="p">),</span>
                          <span class="n">params</span><span class="o">=</span><span class="p">{</span><span class="s2">"owner_id"</span><span class="p">:</span> <span class="n">current_user</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="s2">"location"</span><span class="p">:</span> <span class="n">storage_data</span><span class="o">.</span><span class="n">location</span><span class="p">,</span>
                                  <span class="s2">"description"</span><span class="p">:</span> <span class="n">storage_data</span><span class="o">.</span><span class="n">description</span><span class="p">})</span>

    <span class="k">return</span> <span class="s2">"Storage unit has successfully been added to the DB"</span>
</code></pre></div></td></tr></table></div>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h4 class="doc doc-heading" id="src.api.routers.cellar_router.remove_consumed_from_stock">
<code class="highlight language-python"><span class="n">remove_consumed_from_stock</span><span class="p">(</span><span class="n">db_conn</span><span class="p">,</span> <span class="n">current_user</span><span class="p">,</span> <span class="n">bottle_data</span><span class="p">,</span> <span class="n">rate_bottle</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">rating</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>
<span class="doc doc-labels">
<small class="doc doc-label doc-label-async"><code>async</code></small>
</span>
</h4>
<div class="doc doc-contents">
<p>Removes a bottle from your cellar, if the 'rate_bottle' flag is set to True, the rating argument is required, else
it will be ignored and can be left in the default state.</p>
<p>Required scope(s): CELLAR:READ, CELLAR:WRITE</p>
<details class="quote">
<summary>Source code in <code>src/api/routers/cellar_router.py</code></summary>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@router</span><span class="o">.</span><span class="n">patch</span><span class="p">(</span><span class="s2">"/wine_in_cellar/consumed"</span><span class="p">,</span> <span class="n">dependencies</span><span class="o">=</span><span class="p">[</span><span class="n">Security</span><span class="p">(</span><span class="n">get_current_active_user</span><span class="p">)])</span>
<span class="k">async</span> <span class="k">def</span> <span class="nf">remove_consumed_from_stock</span><span class="p">(</span><span class="n">db_conn</span><span class="p">:</span> <span class="n">Annotated</span><span class="p">[</span><span class="n">JdbcDbConn</span><span class="p">,</span> <span class="n">Depends</span><span class="p">(</span><span class="n">DB_CONN</span><span class="p">)],</span>
                                     <span class="n">current_user</span><span class="p">:</span> <span class="n">Annotated</span><span class="p">[</span><span class="n">OwnerModel</span><span class="p">,</span> <span class="n">Depends</span><span class="p">(</span><span class="n">get_current_active_user</span><span class="p">)],</span>
                                     <span class="n">bottle_data</span><span class="p">:</span> <span class="n">ConsumedBottleModel</span><span class="p">,</span>
                                     <span class="n">rate_bottle</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
                                     <span class="n">rating</span><span class="p">:</span> <span class="n">RatingModel</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""</span>
<span class="sd">    Removes a bottle from your cellar, if the 'rate_bottle' flag is set to True, the rating argument is required, else</span>
<span class="sd">    it will be ignored and can be left in the default state.</span>

<span class="sd">    Required scope(s): CELLAR:READ, CELLAR:WRITE</span>
<span class="sd">    """</span>
    <span class="c1"># Verify the wine exists in the DB</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="k">await</span> <span class="n">wine_in_db</span><span class="p">(</span><span class="n">db_conn</span><span class="o">=</span><span class="n">db_conn</span><span class="p">,</span> <span class="n">wine_id</span><span class="o">=</span><span class="n">bottle_data</span><span class="o">.</span><span class="n">wine_id</span><span class="p">):</span>
        <span class="k">raise</span> <span class="n">HTTPException</span><span class="p">(</span><span class="n">status_code</span><span class="o">=</span><span class="n">status</span><span class="o">.</span><span class="n">HTTP_404_NOT_FOUND</span><span class="p">,</span>
                            <span class="n">detail</span><span class="o">=</span><span class="sa">f</span><span class="s2">"Wine with wine_id: </span><span class="si">{</span><span class="n">bottle_data</span><span class="o">.</span><span class="n">wine_id</span><span class="si">}</span><span class="s2"> is not found in the DB. Make sure to use "</span>
                                   <span class="sa">f</span><span class="s2">"an existing wine ID in order to mark the correct wine as consumed"</span><span class="p">)</span>
    <span class="c1"># Add a rating to the DB if the data is provided</span>
    <span class="k">if</span> <span class="n">rate_bottle</span><span class="p">:</span>
        <span class="k">await</span> <span class="n">add_rating_to_db</span><span class="p">(</span><span class="n">db_conn</span><span class="o">=</span><span class="n">db_conn</span><span class="p">,</span> <span class="n">user_id</span><span class="o">=</span><span class="n">current_user</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">wine_id</span><span class="o">=</span><span class="n">bottle_data</span><span class="o">.</span><span class="n">wine_id</span><span class="p">,</span> <span class="n">rating</span><span class="o">=</span><span class="n">rating</span><span class="p">)</span>

    <span class="k">await</span> <span class="n">update_quantity_in_cellar</span><span class="p">(</span><span class="n">db_conn</span><span class="o">=</span><span class="n">db_conn</span><span class="p">,</span> <span class="n">wine_id</span><span class="o">=</span><span class="n">bottle_data</span><span class="o">.</span><span class="n">wine_id</span><span class="p">,</span> <span class="n">bottle_data</span><span class="o">=</span><span class="n">bottle_data</span><span class="p">,</span> <span class="n">add</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="k">return</span> <span class="s2">"Consumed bottle is updated in the DB"</span>
</code></pre></div></td></tr></table></div>
</details>
</div>
</div>
</div>
</div>
</div><h3 id="cellar_views"><em>cellar_views</em></h3>
<div class="doc doc-object doc-module">
<a id="src.api.routers.cellar_views_router"></a>
<div class="doc doc-contents first">
<div class="doc doc-children">
<div class="doc doc-object doc-function">
<h4 class="doc doc-heading" id="src.api.routers.cellar_views_router.get_bottle_open_window">
<code class="highlight language-python"><span class="n">get_bottle_open_window</span><span class="p">(</span><span class="n">db_conn</span><span class="p">,</span> <span class="n">current_user</span><span class="p">,</span> <span class="n">drink_year</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">beverage_type</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>
<span class="doc doc-labels">
<small class="doc doc-label doc-label-async"><code>async</code></small>
</span>
</h4>
<div class="doc doc-contents">
<p>Retrieve all bottles that are drinkable now or within a specified year. The returned list of drink-ready bottles
can be trimmed by specifying a certain beverage_type.</p>
<p>Required scope(s): CELLAR:READ</p>
<details class="quote">
<summary>Source code in <code>src/api/routers/cellar_views_router.py</code></summary>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@router</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"/wine_in_cellar/drink_in_window"</span><span class="p">,</span> <span class="n">response_model</span><span class="o">=</span><span class="nb">list</span><span class="p">[</span><span class="n">CellarOutModel</span><span class="p">],</span>
            <span class="n">dependencies</span><span class="o">=</span><span class="p">[</span><span class="n">Security</span><span class="p">(</span><span class="n">get_current_active_user</span><span class="p">)])</span>
<span class="k">async</span> <span class="k">def</span> <span class="nf">get_bottle_open_window</span><span class="p">(</span><span class="n">db_conn</span><span class="p">:</span> <span class="n">Annotated</span><span class="p">[</span><span class="n">JdbcDbConn</span><span class="p">,</span> <span class="n">Depends</span><span class="p">(</span><span class="n">DB_CONN</span><span class="p">)],</span>
                                 <span class="n">current_user</span><span class="p">:</span> <span class="n">Annotated</span><span class="p">[</span><span class="n">OwnerModel</span><span class="p">,</span> <span class="n">Depends</span><span class="p">(</span><span class="n">get_current_active_user</span><span class="p">)],</span>
                                 <span class="n">drink_year</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                                 <span class="n">beverage_type</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">CellarOutModel</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">"""</span>
<span class="sd">    Retrieve all bottles that are drinkable now or within a specified year. The returned list of drink-ready bottles</span>
<span class="sd">    can be trimmed by specifying a certain beverage_type.</span>

<span class="sd">    Required scope(s): CELLAR:READ</span>
<span class="sd">    """</span>
    <span class="n">drink_when_cond</span> <span class="o">=</span> <span class="s1">'c.drink_from &lt;= </span><span class="si">%(drink_year)s</span><span class="s1"> AND c.drink_before &gt;= </span><span class="si">%(drink_year)s</span><span class="s1">'</span>
    <span class="n">owner_cond</span> <span class="o">=</span> <span class="s1">'c.owner_id = </span><span class="si">%(user_id)s</span><span class="s1">'</span>
    <span class="n">drink_year</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">year</span> <span class="k">if</span> <span class="n">drink_year</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">drink_year</span>

    <span class="n">params</span> <span class="o">=</span> <span class="p">{</span><span class="s2">"drink_year"</span><span class="p">:</span> <span class="n">datetime</span><span class="p">(</span><span class="n">year</span><span class="o">=</span><span class="n">drink_year</span><span class="p">,</span> <span class="n">month</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">day</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span> <span class="s2">"user_id"</span><span class="p">:</span> <span class="n">current_user</span><span class="o">.</span><span class="n">id</span><span class="p">}</span>
    <span class="n">where</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">'WHERE </span><span class="si">{</span><span class="n">drink_when_cond</span><span class="si">}</span><span class="s1"> AND </span><span class="si">{</span><span class="n">owner_cond</span><span class="si">}</span><span class="s1"> '</span>
    <span class="k">if</span> <span class="n">beverage_type</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">params</span><span class="p">[</span><span class="s2">"bev_type"</span><span class="p">]</span> <span class="o">=</span> <span class="n">beverage_type</span>
        <span class="n">where</span> <span class="o">+=</span> <span class="sa">f</span><span class="s1">'AND w.type = %(bev_type)s'</span>
    <span class="k">return</span> <span class="n">get_cellar_out_data</span><span class="p">(</span><span class="n">db_conn</span><span class="o">=</span><span class="n">db_conn</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="n">params</span><span class="p">,</span> <span class="n">where</span><span class="o">=</span><span class="n">where</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h4 class="doc doc-heading" id="src.api.routers.cellar_views_router.get_owners">
<code class="highlight language-python"><span class="n">get_owners</span><span class="p">(</span><span class="n">current_user</span><span class="p">)</span></code>
<span class="doc doc-labels">
<small class="doc doc-label doc-label-async"><code>async</code></small>
</span>
</h4>
<div class="doc doc-contents">
<p>Retrieve your ID.</p>
<p>Required scope(s): CELLAR:READ</p>
<details class="quote">
<summary>Source code in <code>src/api/routers/cellar_views_router.py</code></summary>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@router</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"/owners/get_your_id"</span><span class="p">,</span> <span class="n">dependencies</span><span class="o">=</span><span class="p">[</span><span class="n">Security</span><span class="p">(</span><span class="n">get_current_active_user</span><span class="p">)])</span>
<span class="k">async</span> <span class="k">def</span> <span class="nf">get_owners</span><span class="p">(</span><span class="n">current_user</span><span class="p">:</span> <span class="n">Annotated</span><span class="p">[</span><span class="n">OwnerModel</span><span class="p">,</span> <span class="n">Depends</span><span class="p">(</span><span class="n">get_current_active_user</span><span class="p">)])</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""</span>
<span class="sd">    Retrieve your ID.</span>

<span class="sd">    Required scope(s): CELLAR:READ</span>
<span class="sd">    """</span>
    <span class="k">return</span> <span class="n">current_user</span><span class="o">.</span><span class="n">id</span>
</code></pre></div></td></tr></table></div>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h4 class="doc doc-heading" id="src.api.routers.cellar_views_router.get_stock_on_bottle">
<code class="highlight language-python"><span class="n">get_stock_on_bottle</span><span class="p">(</span><span class="n">db_conn</span><span class="p">,</span> <span class="n">current_user</span><span class="p">,</span> <span class="n">wine_id</span><span class="p">)</span></code>
<span class="doc doc-labels">
<small class="doc doc-label doc-label-async"><code>async</code></small>
</span>
</h4>
<div class="doc doc-contents">
<p>Get an overview of all your bottles of a specific wine stored in your cellar.</p>
<p>Required scope(s): CELLAR:READ</p>
<details class="quote">
<summary>Source code in <code>src/api/routers/cellar_views_router.py</code></summary>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@router</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"/wine_in_cellar/get_stock_on_bottle"</span><span class="p">,</span>  <span class="n">response_model</span><span class="o">=</span><span class="nb">list</span><span class="p">[</span><span class="n">CellarOutModel</span><span class="p">],</span>
            <span class="n">dependencies</span><span class="o">=</span><span class="p">[</span><span class="n">Security</span><span class="p">(</span><span class="n">get_current_active_user</span><span class="p">)])</span>
<span class="k">async</span> <span class="k">def</span> <span class="nf">get_stock_on_bottle</span><span class="p">(</span><span class="n">db_conn</span><span class="p">:</span> <span class="n">Annotated</span><span class="p">[</span><span class="n">JdbcDbConn</span><span class="p">,</span> <span class="n">Depends</span><span class="p">(</span><span class="n">DB_CONN</span><span class="p">)],</span>
                              <span class="n">current_user</span><span class="p">:</span> <span class="n">Annotated</span><span class="p">[</span><span class="n">OwnerModel</span><span class="p">,</span> <span class="n">Depends</span><span class="p">(</span><span class="n">get_current_active_user</span><span class="p">)],</span>
                              <span class="n">wine_id</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">CellarOutModel</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">"""</span>
<span class="sd">    Get an overview of all your bottles of a specific wine stored in your cellar.</span>

<span class="sd">    Required scope(s): CELLAR:READ</span>
<span class="sd">    """</span>
    <span class="k">return</span> <span class="n">get_cellar_out_data</span><span class="p">(</span><span class="n">db_conn</span><span class="o">=</span><span class="n">db_conn</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="p">{</span><span class="s2">"user_id"</span><span class="p">:</span> <span class="n">current_user</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="s2">"wine_id"</span><span class="p">:</span> <span class="n">wine_id</span><span class="p">},</span>
                               <span class="n">where</span><span class="o">=</span><span class="s2">"WHERE c.owner_id = </span><span class="si">%(user_id)s</span><span class="s2"> AND wine_id = </span><span class="si">%(wine_id)s</span><span class="s2">"</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h4 class="doc doc-heading" id="src.api.routers.cellar_views_router.get_storage_units">
<code class="highlight language-python"><span class="n">get_storage_units</span><span class="p">(</span><span class="n">db_conn</span><span class="p">,</span> <span class="n">current_user</span><span class="p">)</span></code>
<span class="doc doc-labels">
<small class="doc doc-label doc-label-async"><code>async</code></small>
</span>
</h4>
<div class="doc doc-contents">
<p>Retrieve all your storage units registered within the DB.</p>
<p>Required scope(s): CELLAR:READ</p>
<details class="quote">
<summary>Source code in <code>src/api/routers/cellar_views_router.py</code></summary>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@router</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"/storages/get"</span><span class="p">,</span> <span class="n">response_model</span><span class="o">=</span><span class="nb">list</span><span class="p">[</span><span class="n">StorageOutModel</span><span class="p">],</span> <span class="n">dependencies</span><span class="o">=</span><span class="p">[</span><span class="n">Security</span><span class="p">(</span><span class="n">get_current_active_user</span><span class="p">)])</span>
<span class="k">async</span> <span class="k">def</span> <span class="nf">get_storage_units</span><span class="p">(</span><span class="n">db_conn</span><span class="p">:</span> <span class="n">Annotated</span><span class="p">[</span><span class="n">JdbcDbConn</span><span class="p">,</span> <span class="n">Depends</span><span class="p">(</span><span class="n">DB_CONN</span><span class="p">)],</span>
                            <span class="n">current_user</span><span class="p">:</span> <span class="n">Annotated</span><span class="p">[</span><span class="n">OwnerModel</span><span class="p">,</span> <span class="n">Depends</span><span class="p">(</span><span class="n">get_current_active_user</span><span class="p">)]</span>
                            <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">StorageOutModel</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">"""</span>
<span class="sd">    Retrieve all your storage units registered within the DB.</span>

<span class="sd">    Required scope(s): CELLAR:READ</span>
<span class="sd">    """</span>
    <span class="k">return</span> <span class="n">db_conn</span><span class="o">.</span><span class="n">execute_query_select</span><span class="p">(</span><span class="n">query</span><span class="o">=</span><span class="s2">"SELECT * FROM cellar.storages WHERE owner_id = </span><span class="si">%(owner_id)s</span><span class="s2">"</span><span class="p">,</span>
                                        <span class="n">params</span><span class="o">=</span><span class="p">{</span><span class="s2">"owner_id"</span><span class="p">:</span> <span class="n">current_user</span><span class="o">.</span><span class="n">id</span><span class="p">},</span>
                                        <span class="n">get_fields</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h4 class="doc doc-heading" id="src.api.routers.cellar_views_router.get_wine_rating">
<code class="highlight language-python"><span class="n">get_wine_rating</span><span class="p">(</span><span class="n">db_conn</span><span class="p">,</span> <span class="n">current_user</span><span class="p">,</span> <span class="n">wine_id</span><span class="p">,</span> <span class="n">only_your_ratings</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>
<span class="doc doc-labels">
<small class="doc doc-label doc-label-async"><code>async</code></small>
</span>
</h4>
<div class="doc doc-contents">
<p>Retrieves ratings for a specific wine/bottle. Make sure to set the 'only_your_ratings' to True if you only want
to see your ratings on the wine. If set to False, all ratings will be given.</p>
<p>Required scope(s): CELLAR:READ</p>
<details class="quote">
<summary>Source code in <code>src/api/routers/cellar_views_router.py</code></summary>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@router</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"/wine_in_cellar/get_wine_ratings"</span><span class="p">,</span> <span class="n">response_model</span><span class="o">=</span><span class="nb">list</span><span class="p">[</span><span class="n">RatingInDbModel</span><span class="p">],</span>
            <span class="n">dependencies</span><span class="o">=</span><span class="p">[</span><span class="n">Security</span><span class="p">(</span><span class="n">get_current_active_user</span><span class="p">)])</span>
<span class="k">async</span> <span class="k">def</span> <span class="nf">get_wine_rating</span><span class="p">(</span><span class="n">db_conn</span><span class="p">:</span> <span class="n">Annotated</span><span class="p">[</span><span class="n">JdbcDbConn</span><span class="p">,</span> <span class="n">Depends</span><span class="p">(</span><span class="n">DB_CONN</span><span class="p">)],</span>
                          <span class="n">current_user</span><span class="p">:</span> <span class="n">Annotated</span><span class="p">[</span><span class="n">OwnerModel</span><span class="p">,</span> <span class="n">Depends</span><span class="p">(</span><span class="n">get_current_active_user</span><span class="p">)],</span>
                          <span class="n">wine_id</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
                          <span class="n">only_your_ratings</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">RatingInDbModel</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">"""</span>
<span class="sd">    Retrieves ratings for a specific wine/bottle. Make sure to set the 'only_your_ratings' to True if you only want</span>
<span class="sd">    to see your ratings on the wine. If set to False, all ratings will be given.</span>

<span class="sd">    Required scope(s): CELLAR:READ</span>
<span class="sd">    """</span>
    <span class="c1"># Verify the wine exists in the DB</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="k">await</span> <span class="n">wine_in_db</span><span class="p">(</span><span class="n">db_conn</span><span class="o">=</span><span class="n">db_conn</span><span class="p">,</span> <span class="n">wine_id</span><span class="o">=</span><span class="n">wine_id</span><span class="p">):</span>
        <span class="k">raise</span> <span class="n">HTTPException</span><span class="p">(</span><span class="n">status_code</span><span class="o">=</span><span class="n">status</span><span class="o">.</span><span class="n">HTTP_404_NOT_FOUND</span><span class="p">,</span>
                            <span class="n">detail</span><span class="o">=</span><span class="sa">f</span><span class="s2">"Wine with wine_id: </span><span class="si">{</span><span class="n">wine_id</span><span class="si">}</span><span class="s2"> is not found in the DB. Make sure to use an "</span>
                                   <span class="sa">f</span><span class="s2">"existing wine ID in order to rate the correct wine"</span><span class="p">)</span>
    <span class="c1"># Retrieve the ratings from the DB</span>
    <span class="n">query</span> <span class="o">=</span> <span class="s2">"SELECT * FROM cellar.ratings WHERE wine_id = </span><span class="si">%(wine_id)s</span><span class="s2">"</span>
    <span class="k">if</span> <span class="n">only_your_ratings</span><span class="p">:</span>
        <span class="c1"># Note that an f-string is used for the rater_id since sql-injection risks are mitigated due to the user id</span>
        <span class="c1"># originating from the OwnerModel and thus enforcing the value to be an integer</span>
        <span class="n">query</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">query</span><span class="si">}</span><span class="s2"> AND rater_id = '</span><span class="si">{</span><span class="n">current_user</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s2">'"</span>
    <span class="k">return</span> <span class="n">db_conn</span><span class="o">.</span><span class="n">execute_query_select</span><span class="p">(</span><span class="n">query</span><span class="o">=</span><span class="n">query</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="p">{</span><span class="s2">"wine_id"</span><span class="p">:</span> <span class="n">wine_id</span><span class="p">},</span> <span class="n">get_fields</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h4 class="doc doc-heading" id="src.api.routers.cellar_views_router.get_your_bottles">
<code class="highlight language-python"><span class="n">get_your_bottles</span><span class="p">(</span><span class="n">db_conn</span><span class="p">,</span> <span class="n">current_user</span><span class="p">,</span> <span class="n">storage_unit</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>
<span class="doc doc-labels">
<small class="doc doc-label doc-label-async"><code>async</code></small>
</span>
</h4>
<div class="doc doc-contents">
<p>Get an overview of all your bottles stored in your cellar. If the 'storage_unit' id is specified, only the bottles
in that specific storage unit are shown.</p>
<p>Required scope(s): CELLAR:READ</p>
<details class="quote">
<summary>Source code in <code>src/api/routers/cellar_views_router.py</code></summary>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@router</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"/wine_in_cellar/get_your_bottles"</span><span class="p">,</span> <span class="n">response_model</span><span class="o">=</span><span class="nb">list</span><span class="p">[</span><span class="n">CellarOutModel</span><span class="p">],</span>
            <span class="n">dependencies</span><span class="o">=</span><span class="p">[</span><span class="n">Security</span><span class="p">(</span><span class="n">get_current_active_user</span><span class="p">)])</span>
<span class="k">async</span> <span class="k">def</span> <span class="nf">get_your_bottles</span><span class="p">(</span><span class="n">db_conn</span><span class="p">:</span> <span class="n">Annotated</span><span class="p">[</span><span class="n">JdbcDbConn</span><span class="p">,</span> <span class="n">Depends</span><span class="p">(</span><span class="n">DB_CONN</span><span class="p">)],</span>
                           <span class="n">current_user</span><span class="p">:</span> <span class="n">Annotated</span><span class="p">[</span><span class="n">OwnerModel</span><span class="p">,</span> <span class="n">Depends</span><span class="p">(</span><span class="n">get_current_active_user</span><span class="p">)],</span>
                           <span class="n">storage_unit</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">CellarOutModel</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">"""</span>
<span class="sd">    Get an overview of all your bottles stored in your cellar. If the 'storage_unit' id is specified, only the bottles</span>
<span class="sd">    in that specific storage unit are shown.</span>

<span class="sd">    Required scope(s): CELLAR:READ</span>
<span class="sd">    """</span>
    <span class="k">if</span> <span class="n">storage_unit</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">get_cellar_out_data</span><span class="p">(</span><span class="n">db_conn</span><span class="o">=</span><span class="n">db_conn</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="p">{</span><span class="s2">"user_id"</span><span class="p">:</span> <span class="n">current_user</span><span class="o">.</span><span class="n">id</span><span class="p">},</span>
                                   <span class="n">where</span><span class="o">=</span><span class="s2">"WHERE c.owner_id = </span><span class="si">%(user_id)s</span><span class="s2">"</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">get_cellar_out_data</span><span class="p">(</span><span class="n">db_conn</span><span class="o">=</span><span class="n">db_conn</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="p">{</span><span class="s2">"user_id"</span><span class="p">:</span> <span class="n">current_user</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="s2">"storage_unit"</span><span class="p">:</span> <span class="n">storage_unit</span><span class="p">},</span>
                                   <span class="n">where</span><span class="o">=</span><span class="s2">"WHERE c.owner_id = </span><span class="si">%(user_id)s</span><span class="s2"> AND storage_unit = </span><span class="si">%(storage_unit)s</span><span class="s2">"</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h4 class="doc doc-heading" id="src.api.routers.cellar_views_router.get_your_ratings">
<code class="highlight language-python"><span class="n">get_your_ratings</span><span class="p">(</span><span class="n">db_conn</span><span class="p">,</span> <span class="n">current_user</span><span class="p">)</span></code>
<span class="doc doc-labels">
<small class="doc doc-label doc-label-async"><code>async</code></small>
</span>
</h4>
<div class="doc doc-contents">
<p>Retrieves all your ratings for all wines/bottles.</p>
<p>Required scope(s): CELLAR:READ</p>
<details class="quote">
<summary>Source code in <code>src/api/routers/cellar_views_router.py</code></summary>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@router</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"/wine_in_cellar/get_your_ratings"</span><span class="p">,</span> <span class="n">response_model</span><span class="o">=</span><span class="nb">list</span><span class="p">[</span><span class="n">RatingInDbModel</span><span class="p">],</span>
            <span class="n">dependencies</span><span class="o">=</span><span class="p">[</span><span class="n">Security</span><span class="p">(</span><span class="n">get_current_active_user</span><span class="p">)])</span>
<span class="k">async</span> <span class="k">def</span> <span class="nf">get_your_ratings</span><span class="p">(</span><span class="n">db_conn</span><span class="p">:</span> <span class="n">Annotated</span><span class="p">[</span><span class="n">JdbcDbConn</span><span class="p">,</span> <span class="n">Depends</span><span class="p">(</span><span class="n">DB_CONN</span><span class="p">)],</span>
                           <span class="n">current_user</span><span class="p">:</span> <span class="n">Annotated</span><span class="p">[</span><span class="n">OwnerModel</span><span class="p">,</span> <span class="n">Depends</span><span class="p">(</span><span class="n">get_current_active_user</span><span class="p">)]</span>
                           <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">RatingInDbModel</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">"""</span>
<span class="sd">    Retrieves all your ratings for all wines/bottles.</span>

<span class="sd">    Required scope(s): CELLAR:READ</span>
<span class="sd">    """</span>
    <span class="c1"># Retrieve the ratings from the DB</span>
    <span class="k">return</span> <span class="n">db_conn</span><span class="o">.</span><span class="n">execute_query_select</span><span class="p">(</span><span class="n">query</span><span class="o">=</span><span class="s2">"SELECT * FROM cellar.ratings WHERE rater_id = </span><span class="si">%(rater_id)s</span><span class="s2">"</span><span class="p">,</span>
                                        <span class="n">params</span><span class="o">=</span><span class="p">{</span><span class="s2">"rater_id"</span><span class="p">:</span> <span class="n">current_user</span><span class="o">.</span><span class="n">id</span><span class="p">},</span> <span class="n">get_fields</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
</details>
</div>
</div>
</div>
</div>
</div><h2 id="api-choices">API choices</h2>
<h3 id="fastapi">FastAPI</h3>
<p>...</p>
<h3 id="partition-key-and-id-in-the-cosmos-db">Partition Key and ID in the cosmos DB</h3>
<h3 id="authentication">Authentication</h3>
<p>oath2</p>
<aside class="md-source-file">
<span class="md-source-file__fact">
<span class="md-icon" title="Contributors">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 4a4 4 0 0 1 4 4 4 4 0 0 1-4 4 4 4 0 0 1-4-4 4 4 0 0 1 4-4m0 10c4.42 0 8 1.79 8 4v2H4v-2c0-2.21 3.58-4 8-4Z"></path></svg>
</span>
<nav>
<a href="mailto:rogierz@hotmail.com">RJJZitman</a>
</nav>
</span>
</aside>
</article>
</div>
<script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var tab,labels=set.querySelector(".tabbed-labels");for(tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script>
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
</div>
</main>
<footer class="md-footer">
<div class="md-footer-meta md-typeset">
<div class="md-footer-meta__inner md-grid">
<div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" rel="noopener" target="_blank">
      Material for MkDocs
    </a>
</div>
</div>
</div>
</footer>
</div>
<div class="md-dialog" data-md-component="dialog">
<div class="md-dialog__inner md-typeset"></div>
</div>
<script id="__config" type="application/json">{"base": "..", "features": ["content.tabs.link", "content.code.copy", "navigation.instant", "navigation.tracking", "navigation.tabs", "navigation.tabs.sticky", "navigation.sections", "navigation.expand"], "search": "../assets/javascripts/workers/search.b8dbb3d2.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
<script src="../assets/javascripts/bundle.bd41221c.min.js"></script>
<script>document$.subscribe(() => {
            window.update_swagger_ui_iframe_height = function (id) {
                var iFrameID = document.getElementById(id);
                if (iFrameID) {
                    full_height = (iFrameID.contentWindow.document.body.scrollHeight + 80) + "px";
                    iFrameID.height = full_height;
                    iFrameID.style.height = full_height;
                }
            }
        
            let iframe_id_list = []
            var iframes = document.getElementsByClassName("swagger-ui-iframe");
            for (var i = 0; i < iframes.length; i++) { 
                iframe_id_list.push(iframes[i].getAttribute("id"))
            }
        
            let ticking = true;
            
            document.addEventListener('scroll', function(e) {
                if (!ticking) {
                    window.requestAnimationFrame(()=> {
                        let half_vh = window.innerHeight/2;
                        for(var i = 0; i < iframe_id_list.length; i++) {
                            let element = document.getElementById(iframe_id_list[i])
                            if(element==null){
                                return
                            }
                            let diff = element.getBoundingClientRect().top
                            if(element.contentWindow.update_top_val){
                                element.contentWindow.update_top_val(half_vh - diff)
                            }
                        }
                        ticking = false;
                    });
                    ticking = true;
                }
            });
        
            const dark_scheme_name = "slate"
            
            window.scheme = document.body.getAttribute("data-md-color-scheme")
            const options = {
                attributeFilter: ['data-md-color-scheme'],
            };
            function color_scheme_callback(mutations) {
                for (let mutation of mutations) {
                    if (mutation.attributeName === "data-md-color-scheme") {
                        scheme = document.body.getAttribute("data-md-color-scheme")
                        var iframe_list = document.getElementsByClassName("swagger-ui-iframe")
                        for(var i = 0; i < iframe_list.length; i++) {
                            var ele = iframe_list.item(i);
                            if (ele) {
                                if (scheme === dark_scheme_name) {
                                    ele.contentWindow.enable_dark_mode();
                                } else {
                                    ele.contentWindow.disable_dark_mode();
                                }
                            }
                        }
                    }
                }
            }
            observer = new MutationObserver(color_scheme_callback);
            observer.observe(document.body, options);
            })</script></body>
</html>